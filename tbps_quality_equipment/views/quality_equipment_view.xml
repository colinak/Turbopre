<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>

    <record id="view_quality_equipment_search" model="ir.ui.view">
      <field name="name">quality.equipment.search</field>
      <field name="model">quality.equipment</field>
      <field name="type">search</field>
      <field name="arch" type="xml">
        <search string="Quality Equipment">
          <field string="Descripción" name="name"/>
          <field string="Código" name="code"/>
          <field string="Serial Number" name="serial_no"/>
          <field string="Marca" name="make_id"/>
          <field string="Modelo" name="model"/>
          <field string="Responsable" name="technician_user_id"/>
          <field string="Ubicación" name="location_id"/>
          <field string="Clasifiacación" name="clasification_id"/>
          <field string="Rango" name="rango"/>
          <field string="Apreciación" name="appreciation"/>
          <field string="Status" name="status_id"/>
          <filter string="Asignados" domain="[('stage', '=', 'assigned')]" name="assigned"/>
          <filter string="Prestados" domain="[('stage', '=', 'loan')]" name="loan"/>
          <filter string="Sin asignar" domain="[('stage', '=', 'available')]" name="available"/>
          <filter string="En custodia" domain="[('stage', '=', 'in_custody')]" name="in_custody"/>
          <!--<filter string="En Mantenimiento" domain="[('active', '=', False)]" name="inactive"/>-->
          <filter string="Fuera de servicio" domain="[('active', '=', False)]" name="inactive"/>
          <group string="Group By">
            <filter string="Equipment" name="equipment" domain="" context="{'group_by': 'equipment_id'}"/>
            <filter string="Make" name="make" domain="" context="{'group_by': 'make_id'}"/>
            <filter string="Status" name="make" domain="" context="{'group_by': 'status_id'}"/>
            <filter string="Clasification" name="make" domain="" context="{'group_by': 'clasification_id'}"/>
          </group>
        </search>
      </field>
    </record>
    
    <record id="view_quality_equipment_kanban" model="ir.ui.view">
      <field name="name">quality.equipment.kanban</field>
      <field name="model">quality.equipment</field>
      <field name="arch" type="xml">
        <kanban sample="1" class="o_res_partner_kanban">
          <field name="id"/>
          <field name="name"/>
          <field name="equipment_id"/>
          <field name="stage"/>
          <templates>
            <t t-name="kanban-box">
              <div class="oe_kanban_global_click o_kanban_record_has_image_fill o_hr_kanban_record">
                <field name="image_128" widget="image" class="o_kanban_image_fill_left" options="{'zoom': true, 'zoom_delay': 1000, 'background': true, 'preventClicks': false}"/>
                <!--<div class="oe_kanban_vignette oe_semantic_html_override">-->
                  <div class="oe_kanban_details">
                    <h4 class="oe_partner_heading">
                      <a type="open" class="o_kanban_record_title">
                        <field name="equipment_id"/>
                      </a>
                    </h4>
                    <div class="oe_kanban_content" >
                      <div class="o_kanban_record_body">
                        <t t-name="kanban-tooltip">
                          <ul class="oe_kanban_tooltip" style="list-style: none;">
                            <li> <b>Code:</b> <field name="code"/></li>
                            <li> <b>Marca:</b> <field name="make_id"/></li>
                            <li> <b>Rango:</b> <field name="rango"/></li>
                            <li> <b>Status:</b> <field name="status_id"/> - <field name="stage"/></li>
                            <li> <b>Ubicación:</b> <field name="location_id"/> <field name="shelf_number"/> <field name="shelf_position"/></li>
                          </ul>
                        </t>
                      </div>
                    </div>
                  </div>
                <!--</div>-->
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>

    <record id="view_quality_equipment_form" model="ir.ui.view">
      <field name="name">quality.equipment.form</field>
      <field name="model">quality.equipment</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
        <form string="Quality Equipment">
          <field name="id" invisible="1"/>
          <field name="cali_ver_string" invisible="1"/>
          <header>
            <field name="stage" widget="statusbar" statusbar_visible="available,assigned,loan,in_custody,discarded"/>
          </header>
          <sheet>
            <field name="active" invisible="True" />
            <widget name="web_ribbon" title="Archivado" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
            <div class="oe_title">
              <field name="image_1920" widget='image' class="oe_avatar" options='{"zoom": true, "preview_image":"image_128"}'/>
              <label for="equipment_id" class="oe_edit_only" />
              <h1>
                <field name="equipment_id" string="Equipment"
                  options="{'no_create': True, 'no_create_edit': True}"
                  placeholder="Select Equipment" style="width: 75%;"
                />
                <field name="name" string="Name" invisible="1" />
              </h1>
            </div>
            <group>
              <group>
                <field name="code" placeholder="Código Interno" />
                <field name="serial_no" placeholder="Serial del Fabricante"/>
                <field name="make_id" placeholder="Select" 
                  options="{'no_create': True, 'no_create_edit': True}"
                />
                <field name="model" />
                <field name="rango" />
                <field name="appreciation" />
                <field name="clasification_id" placeholder="Select" options="{'no_create': True, 'no_create_edit': True}" />
                <field name="status_id" placeholder="Select" options="{'no_create': True, 'no_create_edit': True}" />
              </group>
              <group>
                <field name="technician_user_id" placeholder="Select" options="{'no_create': True, 'no_create_edit': True}" />
                <field name="location_id" placeholder="Select" options="{'no_create': True, 'no_create_edit': True}"/>
                <field name="shelf_number" />
                <field name="shelf_position" />
                <label for="frequency_cal_ver" class="oe_edit_only" attrs="{'invisible': [('status_id', '=', 5)]}" />
                <div class="o_row" attrs="{'invisible': [('status_id', '=', 5)]}">
                  <field name="frequency_cal_ver" 
                    attrs="{'required': ['|', ('status_id', '!=', 3), ('status_id', '!=', 5)]}"
                  />
                  <span>Months</span>
                </div>
                <field name="calibration_date" placeholder="Select"
                  attrs="{
                    'required': [('frequency_cal_ver', '>=', 1)],
                    'invisible': [('status_id', '=', 5)]
                  }"
                />
                <field name="expiration_date" placeholder="Select"
                  attrs="{
                    'required': [('frequency_cal_ver', '>=', 1)],
                    'invisible': [('status_id', '=', 5)]
                  }"
                />
              </group>
              <group colspan="4">
                <field name="note" string="Observations" />
              </group>
            </group>
            <notebook attrs="{'invisible': [('id', '=', False)]}">
              <page string="Calibration / Verification" attrs="{'invisible': [('status_id', '=', 5)]}">
                <field name="calibration_verification_ids"
                  widget="section_and_note_one2many"
                  mode="tree"
                >
                  <form string=" Calibracion or Verificacion">
                    <div class="oe_title">
                      <label for="type_activity_id" class="oe_edit_only" />
                      <h3>
                        <field name="type_activity_id" 
                          options="{'no_create': True, 'no_create_edit': True}"
                          placeholder="Select Activity" style="width: 75%;"
                        />
                        <field name="name" invisible="1" />
                        <field name="equipment_id" invisible="1" />
                      </h3>
                    </div>
                    <group col="4">
                      <field name="clasification" placeholder="Seleccione" required="True" />
                      <field name="final_condition_id" placeholder="Select" 
                        options="{'no_create': True, 'no_create_edit': True}"
                      />
                    </group>
                    <group col="4">
                      <field name="date_execute" placeholder="Select" />
                      <field name="date_expiration" placeholder="Select"/>
                      <field name="partner_id" placeholder="Select" 
                        options="{'no_create': True, 'no_create_edit': True}"
                      />
                      <field name="certificate_no" required="True"/>
                      <field name="certificate" filename="certificate_name"/>
                      <field name="certificate_name" invisible="True" />
                    </group>
                    <group colspan="4">
                      <field name="note" />
                    </group>
                  </form>
                  <tree>
                    <field name="type_activity_id" placeholder="Select" />
                    <field name="clasification" placeholder="Seleccione" />
                    <field name="date_execute" placeholder="Select" />
                    <field name="date_expiration" placeholder="Select" readonly="1" />
                    <field name="final_condition_id" placeholder="Select" />
                    <field name="partner_id" placeholder="Select" />
                    <field name="certificate_no" />
                    <field name="certificate" string="Adjunto" widget="binary" filename="certificate_name" />
                    <field name="certificate_name" invisible="True" />
                  </tree>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="view_quality_equipment_tree" model="ir.ui.view">
      <field name="name">quality.equipment.tree</field>
      <field name="model">quality.equipment</field>
      <field name="type">tree</field>
      <field name="arch" type="xml">
        <tree string="Quality Equipment" 
          decoration-success="status_id == 1"
          decoration-muted="status_id == 2"
          decoration-info="status_id in (3,6)"
          decoration-danger="active == False"
        >
          <field name="active" invisible="True" />
          <field name="equipment_id" string="Equipment" />
          <field name="code" />
          <field name="serial_no" />
          <field name="make_id" />
          <field name="model" />
          <field name="rango" />
          <field name="appreciation" />
          <field name="frequency_cal_ver" invisible="True" />
          <field name="cali_ver_string" />
          <field name="status_id" />
          <field name="calibration_date" />
          <field name="expiration_date" />
          <field name="location_id" optional="hide"/>
          <field name="shelf_number" optional="hide"/>
          <field name="shelf_position" optional="hide"/>
          <field name="technician_user_id" optional="hide"/>
          <field name="clasification_id" optional="hide"/>
          <field name="stage" optional="hide" widget="badge" decoration-success="stage == 'available'" decoration-info="stage == 'loan'" decoration-muted="stage == 'assigned'" decoration-danger="stage == 'discarded'" />
        </tree>
      </field>
    </record>

    <record id="action_quality_equipment" model="ir.actions.act_window">
      <field name="name">Equipment</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">quality.equipment</field>
      <field name="view_mode">kanban,tree,form</field>
      <field name="view_id" ref="view_quality_equipment_kanban" />
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Create New Equipment
        </p>
      </field>
    </record>
  
    <menuitem 
      id="menu_quality_equipment_title"
      name="Equipment"
      parent="tbps_quality_equipment.menu_quality_equipment"
      action="tbps_quality_equipment.action_quality_equipment"
      sequence="1"
      groups="base.group_system,group_quality_system,group_quality_manager,group_quality_user"
    />
  
  </data>
</odoo>
